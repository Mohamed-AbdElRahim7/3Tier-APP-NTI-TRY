pipeline {
  agent any

  environment {
    TF_LOG = "ERROR"
  }

  stages {
    stage('Terraform Destroy') {
      steps {
        dir('terraform') {
          withCredentials([
            string(credentialsId: 'aws-access-key-id', variable: 'AWS_ACCESS_KEY_ID'),
            string(credentialsId: 'aws-secret-access-key', variable: 'AWS_SECRET_ACCESS_KEY')
          ]) {
            sh '''
              echo "✅ Initializing Terraform..."
              terraform init -input=false

              echo "⚠️ Starting Terraform Destroy..."
              terraform destroy -auto-approve
            '''
          }
        }
      }
    }
  }
}
